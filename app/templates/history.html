<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MarketPulse - History Viewer</title>

    <link 
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { background-color: #f8f9fa; }
        .card { border-radius: 10px; }
    </style>
</head>

<body>    
{% include "navigation_home.html" %}

<div class="container py-4">

    <h1 class="mb-4">Market History Viewer</h1>

    <!-- FORM -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">

            <div class="row">
                <div class="col-md-4">
                    <label class="form-label">Symbol</label>
                    <select id="symbol" class="form-select">
                        <option value="CAC40">CAC40</option>
                        <option value="BTC_EUR">BTC/EUR</option>
                        <option value="EUR_USD">EUR/USD</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Period</label>
                    <select id="period" class="form-select">
                        <option value="7d">7 days</option>
                        <option value="1mo" selected>1 month</option>
                        <option value="3mo">3 months</option>
                        <option value="6mo">6 months</option>
                        <option value="1y">1 year</option>
                        <option value="5y">5 years</option>
                    </select>
                </div>

                <div class="col-md-4 d-flex align-items-end">
                    <button class="btn btn-primary w-100" onclick="loadHistory()">
                        Load Data
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- CHART -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h4 id="chart-title" class="mb-3">History</h4>
            <canvas id="historyChart" height="100"></canvas>
        </div>
    </div>

</div>


<script>
let chart = null;

function loadHistory() {
    const symbol = document.getElementById("symbol").value;
    const period = document.getElementById("period").value;

    fetch(`/marketpulse/history?symbol=${symbol}&period=${period}`)
        .then(r => r.json())
        .then(json => {

            let labels = json.history.map(p => p.date);
            let close = json.history.map(p => p.close);

            document.getElementById("chart-title").innerText = 
                `${symbol} â€” ${period} history`;

            if (chart) chart.destroy();

            chart = new Chart(document.getElementById("historyChart"), {
                type: "line",
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Close Price",
                        data: close,
                        borderColor: "rgb(75, 192, 192)",
                        backgroundColor: "rgba(75, 192, 192, 0.2)",
                        tension: 0.3
                    }]
                }
            });

        });
}

// Load default on first visit
loadHistory();
</script>

</body>
</html>
